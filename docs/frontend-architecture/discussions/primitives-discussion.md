# Primitives 層の設計議論まとめ

## ✅ 現行方針（最終決定）

> この文書は設計の変遷を記録したものです。**このセクションが現時点で有効な方針**です。

**アーキテクチャ:**

```
primitives/ (shadcn コードを格納・隠蔽、デフォルトを維持)
  → atoms/   (primitives をラップ。デザイン変更は className で上書き)
    → organisms / pages
```

**ルール:**

- primitives の shadcn コードは直接改造しない。デフォルトのまま維持する
- デザイン変更が必要な場合は atoms 以降で `className` を上書きする
- PDCA 速度を優先するため、shadcn デフォルトを最大限活用する

**優先順位:** `アクセシビリティ・堅牢性（Headless）` ＞ `開発スピード（shadcn default）` ＞ `独自の装飾的デザイン`

---

## 議論の記録（変遷）

以下は現行方針に至るまでの設計変遷の記録です。

---

### 第1案：primitives ロック（廃止）

初期構想では、shadcn/ui のデフォルトスタイルをベースにデザインを組み上げる方式を採用していた。そのため primitives 層に shadcn 生成コードをロックし、改造を禁止していた。

```
primitives/ (shadcn/ui 生成コード、改造禁止)
  → atoms/ (薄いラッパー、スタイルなし)
    → molecules/
```

**廃止理由:**

- atoms が primitives の実質パススルーで存在意義が薄い
- primitives 層が Atomic Design の外にあり、UIライブラリの選択がアーキテクチャに直接露出している
- shadcn/ui は「コード生成ツール」であり、生成コードはカスタマイズ前提で提供されている。「改造禁止」は shadcn/ui の思想に反している

---

### ⚠️ 廃止：第2案の決定事項（primitives 廃止案）

> **この決定事項は廃止されました。** 現行方針は冒頭の「✅ 現行方針」セクションを参照してください。

#### 1. primitives 層を廃止し、atoms に直接配置する

```
before:  shadcn install → primitives（ロック）→ atoms（パススルー）
after:   shadcn install → atoms（ここでカスタム）
```

#### 2. サブコンポーネントを個別の atom に分解する

shadcn の1ファイルに含まれるサブコンポーネントはそれぞれ atom になり、以下のディレクトリ構造で配置する:

```
atoms/card/
├── card/index.tsx
├── card-header/index.tsx
├── card-title/index.tsx
├── card-description/index.tsx
├── card-content/index.tsx
└── card-footer/index.tsx
```

#### 3. 関連性のある atoms はディレクトリでグルーピングする

- shadcn の1ファイルに含まれる関連コンポーネント群は、親コンポーネント名のディレクトリ配下にまとめる
- 各パーツは最小単位の atom として個別に export する
- molecules で必要なパーツだけを選んで組み合わせる（全パーツの使用を強制しない）

#### 4. atoms 層の責務（当時の想定）

| 責務                 | 内容                                     |
| -------------------- | ---------------------------------------- |
| スタイルの定義と保護 | cva でバリアントを定義し、見た目をロック |
| headless UI のラップ | Radix UI を内部実装として使用            |
| 契約の提供           | 外部に公開する props のインターフェース  |

**廃止理由:** shadcn を直接改造しながら開発を進めると、デザインの一貫性維持コストが高くなり PDCA の速度を損なうことが判明。現行方針へ移行。

---

## アップデート運用

- **shadcn/ui 自体のアップデートは行わない** — コードを取り込む運用のため、shadcn CLI での再生成は行わない。shadcn/ui 自体はバージョン管理されていないため、アップデートの概念がない
- **内部で使用している headless UI（Radix UI）のアップデートで運用する** — `npm update @radix-ui/*` により、アクセシビリティやブラウザ対応等の改善を取り込む

---

## 未決事項

- **cva と tailwind-variants（tv）の使い分け** — shadcn 由来は cva、それ以外は tv という棲み分けの是非・統一の検討
- **自作 atoms の粒度基準** — shadcn が提供していないコンポーネントを自作する際の判断基準
  - → 基本方針: UIライブラリ（shadcn/ui）で提供されている構成をもとに最小単位として取り扱う
- **ドキュメントの更新** — 既存の設計ドキュメントへの反映

---

## 設計再考

結論として、**「デザインに固執せず、市場検証（PDCA）を最速で回すための構造」**としての技術選定についてです。
以前の設計では、https://hirotobeat.com/blogs/shadcn-ui-design-decision の様な形を採用していたが、プロダクト全体の優先度を考えずにデザインをどのように担保するかのみにフォーカスしてしまっていた。

改めて、プロジェクト全体を視野に入れて、優先度自体を見直すことを行い、UIコンポーネントの設計について再考しました。

---

## プロジェクト全体設計における優先順位

プロジェクト初期において最も重要なのは、完璧なデザインを維持することではなく、**「サービスが市場に刺さるかを検証し、改善し続けられる状態（PDCA）を作ること」**です。そのため、デザインはshadcnに寄せつつ、必要なところはshadcnのデフォルト + 必要なデザインに調整する。

### 方針変遷まとめ

| フェーズ | アーキテクチャ | 判断 |
| --- | --- | --- |
| **第1案**（当初） | primitives にロック・改造禁止 → atoms はパススルー | atoms に存在意義がなく破棄 |
| **第2案**（中間） | primitives 廃止 → atoms に shadcn を直接配置しカスタム | shadcn 改造コストが高く PDCA を阻害するため破棄 |
| **最終決定** | primitives を隠蔽レイヤーとして復活。shadcn デフォルトを維持し、atoms 以降で `className` 上書き | ✅ 採用 |

### 1. なぜ「UIライブラリ」を使うのか

- **アジリティの確保:** ゼロからUIを構築する時間的コストを削減し、ビジネスロジックの検証にリソースを集中させるため。
- **「標準」の即時導入:** プロが設計した「使い勝手の良さ」や「信頼感のある見た目」を初手から手に入れるため。

### 2. なぜ「shadcn/ui」のような形態を選ぶのか（vs 従来のUI Kit）

- **脱・ベンダーロックイン:** ライブラリ（node_modules）の中にコードを閉じ込めず、自分のプロジェクト内にコードを取り込むことで、将来的な「仕様変更」や「独自デザインへの移行」の主導権を自社で握るため。
- **「半完成品」の利便性:**
  - **導入時:** 既存のデザインをそのまま使い、爆速でPDCAを回す。
  - **調整時:** 提供されているデザインをベースに、Tailwind CSSで必要な箇所だけを上書き・変更し、ビジネスの成長に合わせて柔軟に進化させる。

### 3. なぜ「Headless UI（Radix UIなど）」が裏側に必要なのか

- **振る舞いの分離:** アクセシビリティ（ARIA、キーボード操作など）という「実装は難しいが、どのプロダクトでも共通して守るべき正解」を分離し、堅牢な土台として利用するため。
- **Radix UIのみの場合:** ロジックは最強だが、見た目は「0（無）」なので、スタイリングの工数がかかる。
- **shadcn/ui:** Radix UIの上に「80点のデザイン」が最初から乗っている。この「80点からスタートできる」ことが、PDCAの初速を決定づける。

---

## 結論：フロントエンドの戦略的設計

フロントエンドの役割は、単に綺麗な画面を作ることではなく、**「ビジネスの仮説を形にし、変更コストを低く保つこと」**にあります。

- **優先順位:** `アクセシビリティ・堅牢性（Headless）` ＞ `開発スピード（shadcn/ui等）` ＞ `独自の装飾的デザイン`
- **戦略:** 最初は提供されたデザインをフル活用して市場に問い、プロダクトが成長した段階で、プロジェクト内にコピーされたコードを微調整して独自のブランド性を肉付けしていく。

---
